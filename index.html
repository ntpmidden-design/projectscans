<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NTP Xgrid – Projectlinks</title>
  <meta name="description" content="Eenvoudige pagina om links naar Xgrid-projecten te delen." />
  <link rel="icon" href="Logo_NTP.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- UI / Kaart libs -->
  <script src="https://cdn.tailwindcss.com">    // --- Active nav link op basis van scrollpositie ---
    const nav = document.getElementById('mainmenu');
    const links = Array.from(nav.querySelectorAll('a[href^="#"]'));
    const mapById = new Map(links.map(a=>[a.getAttribute('href').slice(1), a]));

    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        const id = e.target.id;
        const a = mapById.get(id);
        if(!a) return;
        if(e.isIntersecting){
          links.forEach(x=>x.classList.remove('is-active'));
          a.classList.add('is-active');
          a.setAttribute('aria-current','page');
        }
      });
    }, {root:null, rootMargin:'-50% 0px -45% 0px', threshold:0});

    ['gis','fme','scan','vgis','ai'].forEach(id=>{ const s=document.getElementById(id); if(s) obs.observe(s); });

    // Sluit mobiele menu na klik
    links.forEach(a=>a.addEventListener('click', ()=>{
      const menu = document.getElementById('mainmenu');
      const hamb = document.querySelector('.hamb');
      if(menu && menu.classList.contains('open')){ menu.classList.remove('open'); if(hamb) hamb.setAttribute('aria-expanded','false'); }
    }));
  </script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

  <style>
  :root{
    --ntp-cyan:#00AEEF;
    --text:#0f172a;
    --muted:#475569;
    --bg:#ffffff;
    --card:#ffffff;
    --card-border:#e5e7eb;
  }
  html,body{background:var(--bg);color:var(--text);font-family:'Roboto', ui-sans-serif, system-ui; font-weight:400;}
  a{color:var(--ntp-cyan);text-decoration:none}
  a:hover{text-decoration:underline;text-underline-offset:3px}

  .hero{padding:2rem 1rem 2rem;border-bottom:1px solid var(--card-border);background:linear-gradient(180deg,#f8fafc 0%,#ffffff 100%);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .hero .wrap{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;width:100%;}
  .hero-left{display:flex;align-items:center;gap:1rem}
  .hero-left img{height:50px}
  .hero-text nav{font-size:.875rem;color:var(--muted);font-weight:300}
  .hero-text .pagetitle{font-size:2rem;line-height:1.2;margin-top:.25rem;font-weight:700}
  .hero-text .subtle{color:var(--muted);font-weight:300}

  .filters{display:flex;flex-wrap:wrap;gap:.5rem 1rem;align-items:center;justify-content:space-between;margin:1rem 0 1.25rem;font-weight:300}
  .tabs{display:inline-flex;border:1px solid var(--card-border);border-radius:10px;overflow:hidden}
  .tab{padding:.5rem .9rem;font-weight:500;border-right:1px solid var(--card-border);background:#fff;cursor:pointer;transition:background .2s}
  .tab:last-child{border-right:none}
  .tab.is-active{background:var(--ntp-cyan);color:#fff;font-weight:600}
  .tab:hover:not(.is-active){background:#f1f5f9}

  #projects{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1.25rem}
  @media (max-width: 1024px){#projects{grid-template-columns:repeat(2,minmax(0,1fr));}}
  @media (max-width: 640px){#projects{grid-template-columns:1fr}}

  .card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;overflow:hidden;box-shadow:0 2px 10px rgba(2,6,23,.04);transition:transform .2s, box-shadow .2s}
  .card h3{font-size:1.05rem;margin:0;font-weight:500;position:relative;display:inline-block}
  .card h3::after{content:"";position:absolute;left:0;bottom:-4px;width:100%;height:2px;background:var(--ntp-cyan);transform:scaleX(0);transform-origin:left;transition:transform .25s}
  .card:hover h3::after{transform:scaleX(1)}
  .card .meta{font-size:.85rem;color:var(--muted);font-weight:300}
  .card .content{padding:1rem;font-weight:400}
  .card:hover{transform:translateY(-4px);box-shadow:0 4px 14px rgba(2,6,23,.08)}

  .card.has-thumb::before{display:none}
  .thumb{display:block;width:100%;aspect-ratio:16/9;border:0;overflow:hidden;background:#f1f5f9;border-bottom:1px solid var(--card-border)}
  .thumb[disabled], .thumb.osm{pointer-events:none}

  .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;border-radius:8px;padding:.55rem .9rem;font-weight:500;border:1px solid var(--card-border);background:#fff;color:var(--text);text-decoration:none;transition:all .2s}
  .btn:hover{border-color:var(--ntp-cyan);color:var(--ntp-cyan)}
  .btn-primary{background:var(--ntp-cyan);border-color:transparent;color:#fff;font-weight:600;box-shadow:0 1px 3px rgba(0,0,0,.1)}
  .btn-primary:hover{filter:brightness(.95);box-shadow:0 3px 6px rgba(0,0,0,.12)}
  .btn-link{border:none;background:transparent;color:var(--ntp-cyan);padding:0;font-weight:400}

  .qr{width:60px;height:60px;border:1px solid var(--card-border);border-radius:8px;background:#fff}

  #map-wrapper{display:flex;justify-content:center;margin:3rem auto 2rem}
  #map{width:900px;max-width:100%;height:520px;border-radius:14px;border:1px solid var(--card-border);box-shadow:0 2px 12px rgba(2,6,23,.06);overflow:hidden}

  .leaflet-container img { max-width: none !important; max-height: none !important; }
  .leaflet-container .leaflet-tile { max-width: none !important; }
    html { scroll-behavior: smooth; }
  /* Smooth scrolling en nette anchor-offset */
  html{scroll-behavior:smooth}
  .section{scroll-margin-top:140px}

  /* Nav-underline animatie + actieve staat */
  .nav-menu a{position:relative}
  .nav-menu a::after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:var(--ntp-cyan);transform:scaleX(0);transform-origin:left;transition:transform .25s}
  .nav-menu a:hover::after{transform:scaleX(1)}
  .nav-menu a.is-active{color:var(--ntp-cyan)}
  .nav-menu a.is-active::after{transform:scaleX(1)}
</style>
  <style>
    /* --- Top navigatie zoals ntp.nl (licht, responsive) --- */
    .topnav{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--card-border)}
    .topnav .inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;gap:1rem}
    .topnav .brand{display:flex;align-items:center;gap:.75rem;text-decoration:none}
    .topnav .brand img{height:40px}
    .topnav .brand span{font-weight:700;color:var(--text)}
    .nav-menu{display:flex;align-items:center;gap:1.25rem}
    .nav-menu a{color:var(--text);text-decoration:none;font-weight:500;padding:.35rem .25rem;border-radius:6px}
    .nav-menu a:hover{color:var(--ntp-cyan);background:#f1f5f9}
    .hamb{display:none;background:none;border:none;padding:.4rem;border-radius:6px}
    .hamb:focus{outline:2px solid var(--ntp-cyan)}
    @media (max-width:900px){
      .nav-menu{display:none;position:absolute;left:0;right:0;top:60px;background:#fff;border-bottom:1px solid var(--card-border);flex-direction:column;align-items:flex-start;padding:1rem}
      .nav-menu.open{display:flex}
      .hamb{display:inline-flex}
    }
  </style>
</head>
<body>
  <!-- Hoofdpagina logo -->
  <div style="text-align:center; padding:1.5rem 0; border-bottom:1px solid var(--card-border); background:#fff;">
    <img src="NTP_GeoLoket_logo.png" alt="NTP GeoLoket" style="height:100px; width:auto;"/>
  </div>
  <!-- Top navigatie -->
  <header class="topnav" role="banner">
    <div class="inner">
      <a class="brand" href="#" aria-label="NTP Home">
        <img src="Logo_NTP.png" alt="NTP"/>
        <span>NTP</span>
      </a>
      <nav aria-label="Hoofdmenu">
        <button class="hamb" aria-expanded="false" aria-controls="mainmenu" onclick="(function(b){var m=document.getElementById('mainmenu');var o=m.classList.toggle('open');b.setAttribute('aria-expanded',o);})(this)">☰</button>
        <div id=\"mainmenu\" class=\"nav-menu\">
          <a href=\"#gis\">GIS</a>
          <a href=\"#fme\">FME</a>
          <a href=\"#scan\">SCAN</a>
          <a href=\"#vgis\">VGIS</a>
          <a href=\"#ai\">AI</a>
        </div>
      </nav>
    </div>
  </header>
  <section class="hero">
    <div class="wrap">
      <div class="hero-left">
        <img src="Logo_NTP.png" alt="NTP Logo" />
        <div class="hero-text">
          <nav class="breadcrumb">
            <a href="#">Home</a><span class="sep">/</span><span>Projecten</span>
          </nav>
          <h1 class="pagetitle">Projecten op een rij</h1>
          <p class="subtle">Bekijk onze recente projecten. Filter op projectstatus of categorie.</p>
        </div>
      </div>
      <div class="filters">
        <div class="tabs" role="tablist" aria-label="Weergave">
          <button class="tab is-active" role="tab" aria-selected="true">Lijst</button>
          <button class="tab" role="tab" aria-selected="false" onclick="document.getElementById('map').scrollIntoView({behavior:'smooth'})">Kaart</button>
        </div>
        <div class="subtle">Jouw Xgrid-projecten</div>
      </div>
    </div>
  </section>

  <section id="scan" class="section">
  <div class="wrap">
    <div id="projects" class="grid grid-cols-1 md:grid-cols-2"></div>
  </div>

  <h2 class="text-xl font-semibold text-center mt-16">Projecten op de kaart</h2>
  <div id="map-wrapper">
    <div id="map" role="region" aria-label="Projectenkaart"></div>
  </div>

  <script>
  (function(){
    // Thumbnails via OpenStreetMap embed (geen API key nodig)
    function osmEmbedUrl(lat, lng, spanDeg=0.01){
      const dLat = spanDeg;
      const dLng = spanDeg * Math.max(0.5, Math.cos(lat * Math.PI/180));
      const minLat = (lat - dLat).toFixed(6);
      const maxLat = (lat + dLat).toFixed(6);
      const minLng = (lng - dLng).toFixed(6);
      const maxLng = (lng + dLng).toFixed(6);
      const bbox = `${minLng}%2C${minLat}%2C${maxLng}%2C${maxLat}`;
      return `https://www.openstreetmap.org/export/embed.html?bbox=${bbox}&layer=mapnik&marker=${lat}%2C${lng}`;
    }

    const links = [
      { id: "apeldoorn-wilhelmina", title: "Apeldoorn – Wilhelmina Druckerstraat", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-wilhelmina_druckerstraat", lat: 52.211653, lng: 5.9548165 },
      { id: "doetinchem-1", title: "Doetinchem – 1", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-doetinchem_1", lat: 51.9595997, lng: 6.2990643 },
      { id: "huizen-1", title: "Huizen – Stadenlande 1", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-huizen_stadenlande_1", lat: 52.2939495, lng: 5.2532121 },
      { id: "huizen-2", title: "Huizen – Stadenlande 2", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-huizen_stadenlande_2", lat: 52.2883596, lng: 5.2535263 },
      { id: "nijkerk-camperbuurt", title: "Nijkerk – Camperbuurt", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-camperbuurt", lat: 52.2302263, lng: 5.4890607 },
      { id: "nijkerk-depot", title: "Nijkerk – Depot", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-depot_nijkerk", lat: 52.2236767, lng: 5.4610231 },
      { id: "westervoort", title: "Westervoort", url: "https://lcc-viewer.xgrids.com/pub/dbmahu-westervoort", lat: 51.9626715, lng: 5.9669338 }
    ];

    let map = null;
    const markersById = {};
    let markersReady = false;

    function focusMarker(id){
      if (!markersReady || !map) {
        const frame = document.getElementById('map-wrapper');
        if (frame && frame.scrollIntoView) frame.scrollIntoView({ behavior:'smooth', block:'center' });
        return;
      }
      const m = markersById[id];
      if (m) {
        map.setView(m.getLatLng(), 13);
        if (m.openPopup) m.openPopup();
        L.circleMarker(m.getLatLng(), { radius: 6, color: '#00AEEF', weight: 2, fillColor: '#00AEEF', fillOpacity: 0.85 }).addTo(map).bindPopup('Gekozen project');
      }
    }
    window.focusMarker = focusMarker;

    function renderProjects(){
      const listEl = document.getElementById('projects');
      listEl.innerHTML = '';
      links.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card has-thumb';
        const qrId = `qr-${p.id}`;
        card.innerHTML = `
          <div class='content'>
            <h3>${p.title}</h3>
            <div class='mt-2 flex gap-2 items-center'>
              <a href='${p.url}' target='_blank' rel='noopener noreferrer' class='btn btn-primary'>Openen</a>
              <button class='btn' onclick='focusMarker("${p.id}")'>Toon op kaart</button>
              <canvas id='${qrId}' class='qr'></canvas>
            </div>
          </div>`;
        listEl.appendChild(card);
        // Thumbnail bovenaan de card (OpenStreetMap embed)
        const iframe = document.createElement('iframe');
        iframe.className = 'thumb osm';
        iframe.loading = 'lazy';
        iframe.referrerPolicy = 'no-referrer';
        iframe.setAttribute('aria-hidden','true');
        iframe.setAttribute('tabindex','-1');
        iframe.src = osmEmbedUrl(p.lat, p.lng, 0.012);
        card.prepend(iframe);

        try {
          new QRious({ element: document.getElementById(qrId), value: p.url, size: 60, background: 'transparent', foreground: '#00AEEF' });
        } catch(qrErr) {
          console.warn('QR aanmaak mislukt voor', p.id, qrErr);
        }
      });
    }

    function initMap(){
      if (typeof L === 'undefined') {
        const el = document.getElementById('map');
        if (el) el.innerHTML = '<div class="p-4 text-center muted">Kon de interactieve kaart niet laden. Online werkt dit wel.</div>';
        return;
      }
      map = L.map('map', {
        preferCanvas: true,
        worldCopyJump: false,
        updateWhenZooming: true,
        updateWhenMoving: true,
        wheelDebounceTime: 16,
        zoomSnap: 0.25,
        zoomDelta: 0.25,
        fadeAnimation: true,
        zoomAnimation: true,
        keepBuffer: 20
      }).setView([52.15, 5.3], 8);
      setTimeout(() => { try { map.invalidateSize(); } catch(e){} }, 0);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        continuousWorld: true,
        noWrap: false,
        attribution: '&copy; OpenStreetMap',
        updateWhenZooming: true,
        updateWhenIdle: false,
        keepBuffer: 20,
        crossOrigin: true,
        detectRetina: true
      }).addTo(map);

      const defaultIcon = L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
        iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      });

      links.forEach(p => {
        if (p.lat && p.lng){
          const marker = L.marker([p.lat, p.lng], { icon: defaultIcon }).addTo(map)
            .bindPopup(`<b>${p.title}</b><br><a href='${p.url}' target='_blank' rel='noopener noreferrer'>Open project</a>`);
          markersById[p.id] = marker;
        }
      });
      markersReady = true;
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderProjects();
      initMap();
    });
  })();
  </script>
  <!-- Voorbeeldsecties voor lege onderdelen -->
  <section id="gis" class="section" style="padding:4rem 1rem;text-align:center;">
    <h2 class="text-2xl font-semibold mb-4">GIS</h2>
    <p class="subtle">Voorbeeldpagina GIS – inhoud volgt.</p>
  </section>

  <section id="fme" class="section" style="padding:4rem 1rem;text-align:center;">
    <h2 class="text-2xl font-semibold mb-4">FME</h2>
    <p class="subtle">Voorbeeldpagina FME – inhoud volgt.</p>
  </section>

  <section id="vgis" class="section" style="padding:4rem 1rem;text-align:center;">
    <h2 class="text-2xl font-semibold mb-4">VGIS</h2>
    <p class="subtle">Voorbeeldpagina VGIS – inhoud volgt.</p>
  </section>

  <section id="ai" class="section" style="padding:4rem 1rem;text-align:center;">
    <h2 class="text-2xl font-semibold mb-4">AI</h2>
    <p class="subtle">Voorbeeldpagina AI – inhoud volgt.</p>
  </section>

</body>
</html>
